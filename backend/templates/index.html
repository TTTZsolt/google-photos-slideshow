<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slideshow Control Center - V3.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-gradient-start {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }

        .btn-gradient-stop {
            background: linear-gradient(135deg, #f43f5e 0%, #fb923c 100%);
        }

        .status-pulse {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse-ring {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.1);
            }
        }

        .switch-peer:checked~.switch-target {
            background-color: #22c55e;
        }

        .switch-peer:checked~.switch-target::after {
            transform: translateX(100%);
        }

        /* Hide Number Spinners */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen text-slate-900 selection:bg-indigo-100">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- Header -->
        <header class="flex items-center justify-between mb-10">
            <div>
                <h1
                    class="text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">
                    Control Center
                </h1>
                <p class="text-slate-500 font-medium">Global Random Slideshow - V3.2</p>
            </div>
            <div class="flex items-center gap-3">
                <span id="statusDot" class="w-3 h-3 rounded-full bg-slate-300"></span>
                <span id="statusSpanFull"
                    class="text-sm font-semibold uppercase tracking-widest text-slate-400">Idle</span>
            </div>
        </header>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left/Center: Slideshow Management (Span 2) -->
            <div class="lg:col-span-2 space-y-8">

                <!-- Main Controls Card -->
                <div class="glass-panel rounded-3xl p-8 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-5">
                        <i data-lucide="play-circle" class="w-32 h-32"></i>
                    </div>

                    <div class="relative z-10">
                        <h2 class="text-xl font-bold mb-8 flex items-center gap-2">
                            <i data-lucide="sliders" class="w-6 h-6 text-indigo-500"></i>
                            Slideshow Management
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <!-- Start Button -->
                            <button id="startBtn" onclick="startSlideshow()"
                                class="btn-gradient-start text-white p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition-all hover:scale-[1.02] active:scale-95 shadow-lg group disabled:opacity-50">
                                <i data-lucide="play" class="w-10 h-10 transition-transform group-hover:scale-110"></i>
                                <span class="text-lg font-bold">Start Slideshow</span>
                            </button>

                            <!-- Stop Button -->
                            <button id="stopBtn" onclick="stopSlideshow()"
                                class="btn-gradient-stop text-white p-6 rounded-2xl flex flex-col items-center justify-center gap-3 transition-all hover:scale-[1.02] active:scale-95 shadow-lg group disabled:opacity-50">
                                <i data-lucide="square"
                                    class="w-10 h-10 transition-transform group-hover:scale-110"></i>
                                <span class="text-lg font-bold">Stop Slideshow</span>
                            </button>
                        </div>

                        <!-- Primary Row (Interval & TV) -->
                        <div
                            class="flex flex-wrap items-center justify-between gap-6 p-6 bg-white/50 rounded-2xl border border-white">
                            <!-- Interval -->
                            <div class="flex items-center gap-4 h-[52px]">
                                <div
                                    class="bg-white w-[52px] h-[52px] flex items-center justify-center rounded-xl shadow-sm border border-slate-100 text-indigo-500 shrink-0">
                                    <i data-lucide="timer" class="w-6 h-6"></i>
                                </div>
                                <div class="flex flex-col justify-center -translate-y-[2.5px]">
                                    <label for="intervalInput"
                                        class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none">Interval
                                        (s)</label>
                                    <input type="number" id="intervalInput" value="20" min="1"
                                        class="w-20 bg-transparent border-0 p-0 text-lg font-bold focus:ring-0 text-slate-700 leading-none text-center">
                                </div>
                            </div>

                            <!-- TV Casting (Inline) -->
                            <div class="flex items-center gap-4 h-[52px]">
                                <div
                                    class="bg-white w-[52px] h-[52px] flex items-center justify-center rounded-xl shadow-sm border border-slate-100 text-green-500 shrink-0">
                                    <i data-lucide="tv" class="w-6 h-6"></i>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="relative flex items-center h-8">
                                        <select id="deviceSelect"
                                            class="bg-white border-slate-200 rounded-lg py-1 px-3 text-lg font-bold focus:ring-2 focus:ring-green-500 shadow-sm appearance-none min-w-[120px] h-full text-center">
                                            <option value="">TV...</option>
                                        </select>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="castToTV" class="sr-only switch-peer">
                                        <div
                                            class="w-11 h-6 bg-slate-200 rounded-full transition-all switch-target after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all shadow-inner">
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Secondary Row: Settings & Links -->
                        <div class="mt-4 flex items-center justify-between px-6">
                            <!-- Live View (Aligned with Timer Icon) -->
                            <a href="/receiver" target="_blank" class="flex items-center gap-2 group ml-[14px]">
                                <i data-lucide="external-link" class="w-4 h-4 text-indigo-400 mt-0.5"></i>
                                <span
                                    class="text-[11px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-indigo-500 transition-colors">Live
                                    View</span>
                            </a>

                            <!-- Filename Toggle (Moved to Right with "T" icon) -->
                            <div class="flex items-center gap-3 group mr-[14px]">
                                <i data-lucide="type" class="w-4 h-4 text-slate-300 mt-0.5"></i>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <span
                                        class="text-[11px] font-bold text-slate-400 uppercase tracking-widest group-hover:text-purple-500 transition-colors">Show
                                        Filenames</span>
                                    <div class="relative inline-flex items-center">
                                        <input type="checkbox" id="showFilename" class="sr-only switch-peer">
                                        <div
                                            class="w-11 h-6 bg-slate-200 rounded-full transition-all switch-target after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all shadow-inner">
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right: B2 Management Column -->
            <div class="space-y-6">
                <!-- Add New -->
                <div class="glass-panel rounded-3xl p-6 shadow-lg">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Add Connection</h3>
                    <form id="b2Form" class="space-y-3">
                        <input type="text" id="b2KeyId" placeholder="Key ID" required
                            class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-indigo-500 shadow-sm">
                        <input type="password" id="b2AppKey" placeholder="App Key" required
                            class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-indigo-500 shadow-sm">
                        <input type="text" id="b2BucketName" placeholder="Bucket Name" required
                            class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-indigo-500 shadow-sm">
                        <button type="submit"
                            class="w-full bg-slate-900 text-white font-bold p-3 rounded-xl hover:bg-slate-800 transition shadow-lg mt-2 flex items-center justify-center gap-2">
                            <i data-lucide="plus" class="w-5 h-5"></i> Link B2
                        </button>
                    </form>
                </div>

                <!-- Connected Buckets -->
                <div class="glass-panel rounded-3xl p-6 shadow-lg">
                    <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                        <i data-lucide="cloud" class="w-5 h-5 text-blue-500"></i>
                        B2 Nodes
                    </h2>
                    <div class="space-y-4">
                        {% for b2_account in b2_accounts %}
                        <div
                            class="p-4 bg-white/40 border border-slate-100 rounded-2xl flex items-center justify-between group transition-all hover:bg-white/80">
                            <div class="truncate">
                                <p class="font-bold text-slate-700 truncate text-sm">{{ b2_account.bucket_name }}</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span
                                        class="w-1.5 h-1.5 rounded-full {{ 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]' if b2_account.is_active else 'bg-slate-300' }}"></span>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">{{
                                        'Active' if b2_account.is_active else 'Inactive' }}</span>
                                </div>
                            </div>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="syncB2Account({{ b2_account.id }})"
                                    class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg" title="Sync">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteB2Account({{ b2_account.id }})"
                                    class="p-2 text-rose-500 hover:bg-rose-50 rounded-lg" title="Delete">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div class="text-center py-6">
                            <i data-lucide="cloud-off" class="w-10 h-10 text-slate-300 mx-auto mb-2"></i>
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">No nodes linked</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Spotify Settings -->
                <div class="glass-panel rounded-3xl p-6 shadow-lg">
                    <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                        <i data-lucide="music" class="w-5 h-5 text-green-500"></i>
                        Spotify Music
                    </h2>
                    <div class="space-y-4">
                        <!-- Spotify Status -->
                        <div id="spotifyStatus" class="text-center py-3">
                            <span class="text-xs text-slate-400 font-bold uppercase tracking-widest">Loading...</span>
                        </div>

                        <!-- Spotify Credentials (if not set) -->
                        <div id="spotifyCredentials" class="space-y-3" style="display: none;">
                            <input type="text" id="spotifyClientId" placeholder="Client ID"
                                class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-green-500 shadow-sm">
                            <input type="password" id="spotifyClientSecret" placeholder="Client Secret"
                                class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-green-500 shadow-sm">
                            <button onclick="saveSpotifyCredentials()"
                                class="w-full bg-green-600 text-white font-bold p-3 rounded-xl hover:bg-green-700 transition shadow-lg flex items-center justify-center gap-2">
                                <i data-lucide="save" class="w-5 h-5"></i> Save Credentials
                            </button>
                        </div>

                        <!-- Connect Button -->
                        <button id="spotifyConnectBtn" onclick="connectSpotify()" style="display: none;"
                            class="w-full bg-green-600 text-white font-bold p-3 rounded-xl hover:bg-green-700 transition shadow-lg flex items-center justify-center gap-2">
                            <i data-lucide="link" class="w-5 h-5"></i> Connect Spotify
                        </button>

                        <!-- Playlist Selection -->
                        <div id="spotifyPlaylistSection" style="display: none;" class="space-y-3">
                            <select id="playlistSelect"
                                class="w-full bg-white p-3 rounded-xl text-sm border-slate-100 focus:ring-2 focus:ring-green-500 shadow-sm">
                                <option value="">Select Playlist...</option>
                            </select>
                            <button onclick="selectPlaylist()"
                                class="w-full bg-slate-900 text-white font-bold p-3 rounded-xl hover:bg-slate-800 transition shadow-lg">
                                Set Playlist
                            </button>

                            <!-- Music Toggle -->
                            <div class="flex items-center justify-between p-3 bg-white/50 rounded-xl">
                                <span class="text-sm font-bold text-slate-700">Enable Music</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="musicToggle" class="sr-only switch-peer"
                                        onchange="toggleMusic()">
                                    <div
                                        class="w-11 h-6 bg-slate-200 rounded-full transition-all switch-target after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all shadow-inner">
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System -->
                <div class="flex justify-center">
                    <button onclick="resetDatabase()"
                        class="text-[10px] font-bold text-slate-300 hover:text-rose-400 uppercase tracking-tight transition-colors">
                        Core System Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div id="runtimeError"
            class="fixed bottom-8 right-8 max-w-sm glass-panel text-rose-700 p-4 rounded-2xl shadow-2xl border-l-4 border-rose-500 hidden animate-bounce">
            <div class="flex gap-3">
                <i data-lucide="alert-triangle" class="w-6 h-6 shrink-0"></i>
                <div>
                    <p class="font-bold text-sm">System Error</p>
                    <p id="errorText" class="text-xs mt-1 font-medium"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Init Lucide
        lucide.createIcons();

        // DOM Elements
        const castToTVCheckbox = document.getElementById('castToTV');
        const deviceSelect = document.getElementById('deviceSelect');

        // Handle casting switch
        castToTVCheckbox.addEventListener('change', async () => {
            if (castToTVCheckbox.checked) {
                const response = await fetch('/slideshow/status');
                const data = await response.json();
                if (data.running) await castToTVLocal();
            } else {
                await stopCastingLocal(true);
            }
        });

        async function refreshDevices() {
            deviceSelect.innerHTML = '<option value="">Scanning...</option>';
            try {
                const response = await fetch('/slideshow/devices');
                const data = await response.json();
                deviceSelect.innerHTML = '';
                if (data.devices && data.devices.length > 0) {
                    data.devices.forEach(dev => {
                        const opt = document.createElement('option');
                        opt.value = dev; opt.textContent = dev;
                        deviceSelect.appendChild(opt);
                    });
                } else {
                    deviceSelect.innerHTML = '<option value="">No TVs found</option>';
                }
            } catch (e) { deviceSelect.innerHTML = '<option value="">Offline</option>'; }
        }

        async function castToTVLocal() {
            const dev = deviceSelect.value;
            if (!dev) return;
            await fetch(`/slideshow/cast?device_name=${encodeURIComponent(dev)}`, { method: 'POST' });
        }

        async function stopCastingLocal(silent = false) {
            const dev = deviceSelect.value;
            if (!dev) return;
            try {
                await fetch(`/slideshow/stop-cast?device_name=${encodeURIComponent(dev)}`, { method: 'POST' });
                if (!silent) alert('Casting stopped');
            } catch (e) { if (!silent) alert('Stop failed'); }
        }

        async function updateStatus() {
            try {
                const response = await fetch('/slideshow/status');
                const data = await response.json();
                const dot = document.getElementById('statusDot');
                const statusFull = document.getElementById('statusSpanFull');
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                const errDiv = document.getElementById('runtimeError');
                const errTxt = document.getElementById('errorText');

                if (data.error) {
                    errDiv.classList.remove('hidden');
                    errTxt.textContent = data.error;
                } else {
                    errDiv.classList.add('hidden');
                }

                if (data.running) {
                    dot.className = "w-3 h-3 rounded-full bg-green-500 shadow-[0_0_12px_rgba(34,197,94,0.8)] status-pulse";
                    statusFull.textContent = "Live";
                    statusFull.className = "text-sm font-bold uppercase tracking-widest text-green-600";
                    startBtn.disabled = true; stopBtn.disabled = false;
                } else {
                    dot.className = "w-3 h-3 rounded-full bg-slate-300";
                    statusFull.textContent = "Idle";
                    statusFull.className = "text-sm font-bold uppercase tracking-widest text-slate-400";
                    startBtn.disabled = false; stopBtn.disabled = true;
                }
            } catch (e) { }
        }

        async function startSlideshow() {
            const interval = document.getElementById('intervalInput').value;
            const showFilename = document.getElementById('showFilename').checked;
            await fetch(`/slideshow/start?interval=${interval}&show_filename=${showFilename}`, { method: 'POST' });
            if (castToTVCheckbox.checked) await castToTVLocal();
            updateStatus();
        }

        async function stopSlideshow() {
            await fetch('/slideshow/stop', { method: 'POST' });
            updateStatus();
        }

        async function updateSlideshowConfig() {
            const interval = document.getElementById('intervalInput').value;
            const showFilename = document.getElementById('showFilename').checked;
            await fetch(`/slideshow/update-config?interval=${interval}&show_filename=${showFilename}`, { method: 'POST' });
        }

        document.getElementById('showFilename').addEventListener('change', updateSlideshowConfig);
        document.getElementById('intervalInput').addEventListener('change', updateSlideshowConfig);

        async function syncB2Account(id) {
            await fetch(`/b2/sync/${id}`, { method: 'POST' });
            alert('Node sync triggered');
        }

        async function deleteB2Account(id) {
            if (confirm('Detach this B2 node?')) {
                await fetch(`/b2/delete/${id}`, { method: 'POST' });
                window.location.reload();
            }
        }

        document.getElementById('b2Form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = {
                key_id: document.getElementById('b2KeyId').value,
                application_key: document.getElementById('b2AppKey').value,
                bucket_name: document.getElementById('b2BucketName').value
            };
            const response = await fetch('/b2/connect', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (response.ok) window.location.reload();
        });

        async function resetDatabase() {
            if (confirm("Core System Reset? This wipes all links!")) {
                const response = await fetch('/reset', { method: 'POST' });
                if (response.ok) window.location.reload();
            }
        }

        // ========== SPOTIFY FUNCTIONS ==========
        async function updateSpotifyUI() {
            try {
                const response = await fetch('/spotify/config');
                const config = await response.json();

                const statusEl = document.getElementById('spotifyStatus');
                const credsEl = document.getElementById('spotifyCredentials');
                const connectBtn = document.getElementById('spotifyConnectBtn');
                const playlistSection = document.getElementById('spotifyPlaylistSection');
                const musicToggle = document.getElementById('musicToggle');

                if (!config.client_id_set) {
                    // Show credentials form
                    statusEl.innerHTML = '<span class="text-xs text-slate-400 font-bold uppercase tracking-widest">Setup Required</span>';
                    credsEl.style.display = 'block';
                    connectBtn.style.display = 'none';
                    playlistSection.style.display = 'none';
                } else if (!config.authenticated) {
                    // Show connect button
                    statusEl.innerHTML = '<span class="text-xs text-green-500 font-bold uppercase tracking-widest">Ready to Connect</span>';
                    credsEl.style.display = 'none';
                    connectBtn.style.display = 'block';
                    playlistSection.style.display = 'none';
                } else {
                    // Show playlist selection
                    statusEl.innerHTML = '<span class="text-xs text-green-500 font-bold uppercase tracking-widest flex items-center justify-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"></span>Connected</span>';
                    credsEl.style.display = 'none';
                    connectBtn.style.display = 'none';
                    playlistSection.style.display = 'block';
                    musicToggle.checked = config.music_enabled;

                    // Load playlists if not already loaded
                    const playlistSelect = document.getElementById('playlistSelect');
                    if (playlistSelect.options.length === 1) {
                        await loadPlaylists();
                    }

                    // Set selected playlist
                    if (config.selected_playlist_uri) {
                        playlistSelect.value = config.selected_playlist_uri;
                    }
                }
            } catch (e) {
                console.error('Spotify UI update error:', e);
            }
        }

        async function saveSpotifyCredentials() {
            const clientId = document.getElementById('spotifyClientId').value;
            const clientSecret = document.getElementById('spotifyClientSecret').value;

            if (!clientId || !clientSecret) {
                alert('Please enter both Client ID and Secret');
                return;
            }

            try {
                await fetch('/spotify/credentials', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ client_id: clientId, client_secret: clientSecret })
                });
                updateSpotifyUI();
            } catch (e) {
                alert('Failed to save credentials');
            }
        }

        async function connectSpotify() {
            try {
                const response = await fetch('/spotify/auth');
                const data = await response.json();
                window.open(data.auth_url, '_blank');

                // Poll for authentication completion
                const checkAuth = setInterval(async () => {
                    const config = await fetch('/spotify/config');
                    const configData = await config.json();
                    if (configData.authenticated) {
                        clearInterval(checkAuth);
                        updateSpotifyUI();
                    }
                }, 2000);
            } catch (e) {
                alert('Failed to initiate Spotify connection');
            }
        }

        async function loadPlaylists() {
            try {
                const response = await fetch('/spotify/playlists');
                const data = await response.json();
                const playlistSelect = document.getElementById('playlistSelect');

                playlistSelect.innerHTML = '<option value="">Select Playlist...</option>';
                data.playlists.forEach(pl => {
                    const opt = document.createElement('option');
                    opt.value = pl.uri;
                    opt.textContent = `${pl.name} (${pl.tracks} tracks)`;
                    playlistSelect.appendChild(opt);
                });
            } catch (e) {
                console.error('Failed to load playlists:', e);
            }
        }

        async function selectPlaylist() {
            const playlistSelect = document.getElementById('playlistSelect');
            const selectedUri = playlistSelect.value;
            const selectedName = playlistSelect.options[playlistSelect.selectedIndex].text;

            if (!selectedUri) {
                alert('Please select a playlist');
                return;
            }

            try {
                await fetch('/spotify/playlist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ playlist_uri: selectedUri, playlist_name: selectedName })
                });
                alert('Playlist selected!');
            } catch (e) {
                alert('Failed to select playlist');
            }
        }

        async function toggleMusic() {
            const enabled = document.getElementById('musicToggle').checked;
            try {
                await fetch('/spotify/music-toggle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: enabled })
                });
            } catch (e) {
                console.error('Failed to toggle music:', e);
            }
        }

        setInterval(updateStatus, 2000);
        updateStatus();
        refreshDevices();
        updateSpotifyUI();
        setInterval(updateSpotifyUI, 10000); // Update Spotify UI every 10 seconds
    </script>
</body>

</html>